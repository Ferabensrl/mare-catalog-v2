import{initializeApp as c}from"https://www.gstatic.com/firebasejs/12.0.0/firebase-app.js";import{getMessaging as u,getToken as p,onMessage as d}from"https://www.gstatic.com/firebasejs/12.0.0/firebase-messaging.js";import{getAnalytics as b}from"https://www.gstatic.com/firebasejs/12.0.0/firebase-analytics.js";const l={apiKey:"AIzaSyAKQnyX92kFwm5R3XCJHSldB7I1nATI4i8",authDomain:"mare-notifications.firebaseapp.com",projectId:"mare-notifications",storageBucket:"mare-notifications.firebasestorage.app",messagingSenderId:"247760169079",appId:"1:247760169079:web:f434638500d4cc84093e72",measurementId:"G-J3BZH45FHM"},g="BBKXwLsVytTSPwEoVmfH0CzZTsxZvHGT_uEexRTi5Obppt11TxmqtRdMQme65TTva1G6PujZHutpKtd2vu-7PPU",a=c(l);b(a);const n=u(a);class f{constructor(){this.isSupported=!1,this.isSubscribed=!1,this.subscription=null,this.init()}async init(){if("Notification"in window&&"serviceWorker"in navigator&&"PushManager"in window){this.isSupported=!0,console.log("üîî Notificaciones push soportadas");try{const i=await navigator.serviceWorker.register("/sw.js");console.log("‚úÖ Service Worker registrado para notificaciones"),this.subscription=await i.pushManager.getSubscription(),this.isSubscribed=!!this.subscription}catch(i){console.error("‚ùå Error registrando Service Worker:",i)}}else console.warn("‚ö†Ô∏è Notificaciones push no soportadas en este navegador")}async requestPermission(){if(!this.isSupported)throw new Error("Notificaciones no soportadas");return await Notification.requestPermission()==="granted"?(console.log("‚úÖ Permisos de notificaci√≥n concedidos"),!0):(console.warn("‚ùå Permisos de notificaci√≥n denegados"),!1)}async subscribe(){if(!this.isSupported)throw new Error("Notificaciones no soportadas");try{const i=await p(n,{vapidKey:g});if(i)return console.log("‚úÖ Token Firebase obtenido:",i.substring(0,20)+"..."),this.subscription={token:i},this.isSubscribed=!0,localStorage.setItem("mare-firebase-token",i),d(n,o=>{console.log("üîî Mensaje recibido:",o),this.showLocalNotification(o.notification.title,{body:o.notification.body,icon:o.notification.icon||"/icon-192.png"})}),console.log("‚úÖ Suscrito a Firebase notifications"),this.subscription;throw new Error("No se pudo obtener token de Firebase")}catch(i){throw console.error("‚ùå Error suscribi√©ndose a Firebase:",i),i}}async unsubscribe(){if(this.subscription)try{await this.subscription.unsubscribe(),this.isSubscribed=!1,this.subscription=null,console.log("‚úÖ Desuscrito de notificaciones push")}catch(i){console.error("‚ùå Error desuscribi√©ndose:",i)}}async sendSubscriptionToServer(i){localStorage.setItem("mare-push-subscription",JSON.stringify(i)),console.log("üíæ Suscripci√≥n guardada localmente")}showLocalNotification(i,o={}){if(!this.isSupported){alert(`${i}
${o.body||""}`);return}const s={body:o.body||"Nueva actualizaci√≥n disponible",icon:"/icon-192.png",badge:"/icon-192.png",image:o.image,data:o.data||{}};new Notification(i,{...s,...o})}urlBase64ToUint8Array(i){const o="=".repeat((4-i.length%4)%4),s=(i+o).replace(/-/g,"+").replace(/_/g,"/"),t=window.atob(s),r=new Uint8Array(t.length);for(let e=0;e<t.length;++e)r[e]=t.charCodeAt(e);return r}getStatus(){return{isSupported:this.isSupported,isSubscribed:this.isSubscribed,permission:Notification.permission}}}window.mareNotifications=new f;export{f as default};
