const n="BBKXwLsVytTSPwEoVmfH0CzZTsxZvHGT_uEexRTi5Obppt11TxmqtRdMQme65TTva1G6PujZHutpKtd2vu-7PPU";class a{constructor(){this.isSupported=!1,this.isSubscribed=!1,this.subscription=null,this.init()}async init(){if("Notification"in window&&"serviceWorker"in navigator&&"PushManager"in window){this.isSupported=!0,console.log("üîî Notificaciones push soportadas");try{const i=await navigator.serviceWorker.register("/sw.js");console.log("‚úÖ Service Worker registrado para notificaciones"),this.subscription=await i.pushManager.getSubscription(),this.isSubscribed=!!this.subscription}catch(i){console.error("‚ùå Error registrando Service Worker:",i)}}else console.warn("‚ö†Ô∏è Notificaciones push no soportadas en este navegador")}async requestPermission(){if(!this.isSupported)throw new Error("Notificaciones no soportadas");return await Notification.requestPermission()==="granted"?(console.log("‚úÖ Permisos de notificaci√≥n concedidos"),!0):(console.warn("‚ùå Permisos de notificaci√≥n denegados"),!1)}async subscribe(){if(!this.isSupported)throw new Error("Notificaciones no soportadas");try{const i=await navigator.serviceWorker.getRegistration();if(!i)throw new Error("Service Worker no registrado");return this.subscription=await i.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:this.urlBase64ToUint8Array(n)}),this.isSubscribed=!0,console.log("‚úÖ Suscrito a notificaciones push"),await this.sendSubscriptionToServer(this.subscription),this.subscription}catch(i){throw console.error("‚ùå Error suscribi√©ndose a notificaciones:",i),i}}async unsubscribe(){if(this.subscription)try{await this.subscription.unsubscribe(),this.isSubscribed=!1,this.subscription=null,console.log("‚úÖ Desuscrito de notificaciones push")}catch(i){console.error("‚ùå Error desuscribi√©ndose:",i)}}async sendSubscriptionToServer(i){localStorage.setItem("mare-push-subscription",JSON.stringify(i)),console.log("üíæ Suscripci√≥n guardada localmente")}showLocalNotification(i,s={}){if(!this.isSupported){alert(`${i}
${s.body||""}`);return}const o={body:s.body||"Nueva actualizaci√≥n disponible",icon:"/icon-192.png",badge:"/icon-192.png",image:s.image,data:s.data||{}};new Notification(i,{...o,...s})}urlBase64ToUint8Array(i){const s="=".repeat((4-i.length%4)%4),o=(i+s).replace(/-/g,"+").replace(/_/g,"/"),e=window.atob(o),t=new Uint8Array(e.length);for(let r=0;r<e.length;++r)t[r]=e.charCodeAt(r);return t}getStatus(){return{isSupported:this.isSupported,isSubscribed:this.isSubscribed,permission:Notification.permission}}}window.mareNotifications=new a;export{a as default};
